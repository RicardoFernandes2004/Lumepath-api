# LumePath 

## ðŸ’¡ VisÃ£o geral

* **Problema**: baixo controle do consumo de materiais por unidade.
* **SoluÃ§Ã£o**: controle de estoque com histÃ³rico de movimentaÃ§Ãµes, ponto de reposiÃ§Ã£o e alertas.
* **Regras cobertas**:

  1. **Entrada** de material (atualiza saldo, fecha alertas se passou do ponto)
  2. **SaÃ­da** (bloqueia saldo negativo; gera alerta se bateu ponto)
  3. **InventÃ¡rio** (ajuste de reconciliaÃ§Ã£o)
  4. **Alertas** de reposiÃ§Ã£o por unidade
  5. **RelatÃ³rios**: saldo por unidade, consumo por perÃ­odo
  6. **Cadastros**: Unidades, Materiais (inclui ponto de reposiÃ§Ã£o), UsuÃ¡rios
  7. **CorreÃ§Ãµes**: **Estornar movimentaÃ§Ã£o** (ENTR/SAÃD)
  8. **Admin**: Delete **com prÃ©via** (CASCADE manual, opcional)

---

## ðŸ—‚ï¸ Estrutura de pastas

```text
src/
  beans/
    Alerta.java          // POJO
    Estoque.java         // POJO
    Material.java        // POJO
    Movimentacao.java    // POJO
    TipoMovimentacao.java// enum {ENTRADA,SAIDA,AJUSTE}
    Perfil.java          // enum {ATENDENTE,ALMOXARIFE,GESTOR}
    Unidade.java         // POJO
    Usuario.java         // POJO
  dao/
    ConnectionFactory.java
    MaterialDAO.java
    UnidadeDAO.java
    UsuarioDAO.java
    EstoqueDAO.java
    MovimentacaoDAO.java
    AlertaDAO.java
  service/
    EstoqueService.java   // regras de negÃ³cio e transaÃ§Ãµes
    RelatorioService.java // consultas formatadas
  main/
    Main.java             // JOptionPane raiz (menus)
```

---

## ðŸ›¢ï¸ Banco de Dados

**Banco**: Oracle (service name tÃ­pico da FIAP: `ORCL`).

**Tabelas** (resumo): `UNIDADE`, `MATERIAL`, `USUARIO`, `ESTOQUE`, `MOVIMENTACAO`, `ALERTA`.

> DDL completo encontra-se no documento do projeto ou pode ser gerado via script. Exemplo de criaÃ§Ã£o do `MATERIAL`:

```sql
CREATE TABLE MATERIAL (
  ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  CODIGO VARCHAR2(30) NOT NULL UNIQUE,
  DESCRICAO VARCHAR2(200) NOT NULL,
  UNIDADE_MEDIDA VARCHAR2(20) NOT NULL,
  PONTO_REPOSICAO NUMBER DEFAULT 0 NOT NULL
);
```

### Scripts Ãºteis

* **Reset total + IDs voltando a 1**:

```sql
TRUNCATE TABLE ALERTA;
TRUNCATE TABLE MOVIMENTACAO;
TRUNCATE TABLE ESTOQUE;
TRUNCATE TABLE USUARIO;
TRUNCATE TABLE MATERIAL;
TRUNCATE TABLE UNIDADE;

ALTER TABLE ALERTA       MODIFY (ID DROP IDENTITY);
ALTER TABLE ALERTA       MODIFY (ID GENERATED BY DEFAULT AS IDENTITY (START WITH 1));
ALTER TABLE MOVIMENTACAO MODIFY (ID DROP IDENTITY);
ALTER TABLE MOVIMENTACAO MODIFY (ID GENERATED BY DEFAULT AS IDENTITY (START WITH 1));
ALTER TABLE ESTOQUE      MODIFY (ID DROP IDENTITY);
ALTER TABLE ESTOQUE      MODIFY (ID GENERATED BY DEFAULT AS IDENTITY (START WITH 1));
ALTER TABLE USUARIO      MODIFY (ID DROP IDENTITY);
ALTER TABLE USUARIO      MODIFY (ID GENERATED BY DEFAULT AS IDENTITY (START WITH 1));
ALTER TABLE MATERIAL     MODIFY (ID DROP IDENTITY);
ALTER TABLE MATERIAL     MODIFY (ID GENERATED BY DEFAULT AS IDENTITY (START WITH 1));
ALTER TABLE UNIDADE      MODIFY (ID DROP IDENTITY);
ALTER TABLE UNIDADE      MODIFY (ID GENERATED BY DEFAULT AS IDENTITY (START WITH 1));

COMMIT;
```

* **Popular amostras (opcional)**:

```sql
INSERT INTO UNIDADE (NOME) VALUES ('Hematologia');
INSERT INTO UNIDADE (NOME) VALUES ('BioquÃ­mica');
INSERT INTO MATERIAL (CODIGO,DESCRICAO,UNIDADE_MEDIDA,PONTO_REPOSICAO) VALUES ('REAG-001','Reagente A','ml',50);
INSERT INTO MATERIAL (CODIGO,DESCRICAO,UNIDADE_MEDIDA,PONTO_REPOSICAO) VALUES ('TUBO-10','Tubo 10ml','un',100);
INSERT INTO USUARIO (NOME,PERFIL) VALUES ('Encarregado 1','ATENDENTE');
INSERT INTO USUARIO (NOME,PERFIL) VALUES ('Almox 1','ALMOXARIFE');
COMMIT;
```

---

## ðŸ”§ PrÃ©â€‘requisitos

* **Java 17+** (Java 11 tambÃ©m funciona)
* **OJDBC** (`ojdbc11.jar` ou `ojdbc8.jar`)
* Acesso ao **Oracle** (host/porta/service ou SID)

---

## ðŸ”Œ ConfiguraÃ§Ã£o (ConnectionFactory)

> Cada dev cria **sua prÃ³pria** `ConnectionFactory`. NÃ£o comitar credenciais reais.

```java
// src/dao/ConnectionFactory.java
package dao;
import java.sql.*;
public class ConnectionFactory {
    private static final String URL  = "jdbc:oracle:thin:@//<HOST>:<PORT>/<SERVICE>"; // ex: @//oracle.fiap.com.br:1521/ORCL
    private static final String USER = "<SEU_USUARIO>";
    private static final String PASS = "<SUA_SENHA>";
    static { try { Class.forName("oracle.jdbc.driver.OracleDriver"); }
             catch (ClassNotFoundException e) { throw new RuntimeException("OJDBC nÃ£o encontrado no classpath", e);} }
    public static Connection getConnection() throws SQLException { return DriverManager.getConnection(URL, USER, PASS); }
}
```
---

## ðŸ—ï¸ Build & Run

### Linux/Mac

```bash
mkdir -p out
javac -cp ojdbc11.jar -d out $(find src -name "*.java")
java  -cp out:ojdbc11.jar main.Main
```

### Windows (PowerShell)

```powershell
if (!(Test-Path out)) { mkdir out }
$files = Get-ChildItem -Recurse src -Filter *.java | % { $_.FullName }
javac -cp ojdbc11.jar -d out $files
java  -cp out;ojdbc11.jar main.Main
```

---


## ðŸ§  Regras de negÃ³cio (resumo)

* **Saldo** reside em `ESTOQUE` (chave composta `UNIDADE_ID` + `MATERIAL_ID`).
* Cada operaÃ§Ã£o grava histÃ³rico em `MOVIMENTACAO`.
* **Ponto de reposiÃ§Ã£o** em `MATERIAL.PONTO_REPOSICAO`.
* Alerta nasce quando **saldo â‰¤ ponto** e Ã© fechado quando o saldo volta a ficar **> ponto**.
* **TransaÃ§Ãµes**: entradas/saÃ­das/ajustes/estorno rodam com `commit/rollback`.

---

## ðŸ†˜ Troubleshooting

* `ORA-12514/12541`: URL errada (service name vs SID) ou firewall. Teste ping/porta.
* `java.lang.ClassNotFoundException: oracle.jdbc.driver.OracleDriver`: faltou `ojdbc` no classpath.
* `ORA-00942: table or view does not exist`: rode o **DDL** primeiro no **schema** correto.
* `ORA-02292: integrity constraint violated`: vocÃª tentou excluir pai com filhas â†’ use o **delete com prÃ©via** (CASCADE manual) ou o **estorno** especÃ­fico.
* Datas no relatÃ³rio: use formato `YYYY-MM-DD` no input.

## TODO: QND O PROFESSOR DEIXAR USAR SPRING TROCAR TODA ESSA JOÃ‡A MANUAL POR JPA


